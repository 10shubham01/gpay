<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Pay Statement Analyzer</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Flatpickr Date Picker -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
            animation: {
              "fade-in": "fadeIn 0.5s ease-out",
              "slide-up": "slideUp 0.4s ease-out",
              "bounce-in": "bounceIn 0.6s ease-out",
            },
          },
        },
      };
    </script>

    <style>
      * {
        font-family: "Inter", sans-serif;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes bounceIn {
        0% {
          opacity: 0;
          transform: scale(0.3);
        }
        50% {
          transform: scale(1.05);
        }
        70% {
          transform: scale(0.9);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      .drag-over {
        border-color: #4285f4 !important;
        background-color: #e8f0fe !important;
        transform: scale(1.02);
      }

      .filter-input {
        transition: all 0.2s ease;
      }
      .filter-input:focus {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(66, 133, 244, 0.15);
      }

      .table-row {
        transition: all 0.2s ease;
      }
      .table-row:hover {
        background-color: #f8fafc;
      }

      .stat-card {
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
      }

      .sort-btn {
        transition: all 0.2s ease;
      }
      .sort-btn:hover {
        background-color: #f1f5f9;
      }
      .sort-btn.active {
        color: #4285f4;
      }

      .flatpickr-calendar {
        border-radius: 12px !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15) !important;
      }

      .gpay-gradient {
        background: linear-gradient(
          135deg,
          #0b2c74 0%,
          #1d4ed8 45%,
          #0ea5e9 100%
        );
        box-shadow: 0 12px 30px rgba(29, 78, 216, 0.25);
      }

      .pill-btn {
        border: 1px solid #e5e7eb;
        border-radius: 999px;
        padding: 8px 12px;
        font-size: 12px;
        font-weight: 600;
        color: #374151;
        background: #fff;
        transition: all 0.2s ease;
      }
      .pill-btn:hover {
        border-color: #1d4ed8;
        color: #1d4ed8;
        background: #e0ecff;
      }
      .pill-btn.active {
        border-color: #1d4ed8;
        color: #1d4ed8;
        background: #e0ecff;
      }

      .quick-stat {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.9);
      }

      /* Mobile responsive table */
      @media (max-width: 768px) {
        .mobile-card {
          display: block !important;
        }
        .desktop-table {
          display: none !important;
        }
      }
      @media (min-width: 769px) {
        .mobile-card {
          display: none !important;
        }
        .desktop-table {
          display: block !important;
        }
      }
    </style>
  </head>

  <body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2 sm:gap-3">
            <!-- Google Pay Icon -->
            <div
              class="w-10 h-10 sm:w-12 sm:h-12 gpay-gradient rounded-xl flex items-center justify-center shadow-lg"
            >
              <svg
                class="w-6 h-6 sm:w-7 sm:h-7 text-white"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"
                />
              </svg>
            </div>
            <div>
              <h1 class="text-lg sm:text-xl font-bold text-gray-900">
                GPay Analyzer
              </h1>
              <p class="text-xs text-gray-500 hidden sm:block">
                Analyze your transactions instantly
              </p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button
              id="clearBtn"
              class="hidden items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-all"
            >
              <span class="material-icons-outlined text-lg">refresh</span>
              <span class="hidden sm:inline">New File</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
      <!-- Upload Section -->
      <div id="uploadSection" class="animate-fade-in">
        <div
          id="dropZone"
          class="relative bg-white rounded-2xl border-2 border-dashed border-gray-300 p-8 sm:p-16 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50/30 transition-all duration-300"
        >
          <input
            type="file"
            id="pdfInput"
            accept="application/pdf"
            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
          />
          <div class="flex flex-col items-center gap-4 sm:gap-6">
            <!-- GPay styled upload icon -->
            <div
              class="w-24 h-24 sm:w-32 sm:h-32 gpay-gradient rounded-3xl flex items-center justify-center shadow-2xl animate-bounce-in"
            >
              <span
                class="material-icons-outlined text-white text-5xl sm:text-6xl"
                >upload_file</span
              >
            </div>
            <div>
              <p class="text-xl sm:text-2xl font-bold text-gray-800">
                Drop your GPay statement here
              </p>
              <p class="text-sm sm:text-base text-gray-500 mt-2">
                or
                <span class="text-blue-500 font-medium">click to browse</span>
                from your device
              </p>
            </div>
            <div
              class="flex items-center gap-2 text-xs sm:text-sm text-gray-400 bg-gray-100 px-4 py-2 rounded-full"
            >
              <span class="material-icons-outlined text-base">lock</span>
              <span>100% Private - Data never leaves your browser</span>
            </div>

            <!-- Features Preview -->
            <div
              class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mt-4 sm:mt-6 w-full max-w-2xl"
            >
              <div class="bg-blue-50 rounded-xl p-3 sm:p-4 text-center">
                <span
                  class="material-icons-outlined text-blue-500 text-2xl sm:text-3xl"
                  >analytics</span
                >
                <p class="text-xs sm:text-sm font-medium text-gray-700 mt-1">
                  Smart Analytics
                </p>
              </div>
              <div class="bg-green-50 rounded-xl p-3 sm:p-4 text-center">
                <span
                  class="material-icons-outlined text-green-500 text-2xl sm:text-3xl"
                  >filter_alt</span
                >
                <p class="text-xs sm:text-sm font-medium text-gray-700 mt-1">
                  Advanced Filters
                </p>
              </div>
              <div class="bg-yellow-50 rounded-xl p-3 sm:p-4 text-center">
                <span
                  class="material-icons-outlined text-yellow-600 text-2xl sm:text-3xl"
                  >sort</span
                >
                <p class="text-xs sm:text-sm font-medium text-gray-700 mt-1">
                  Sort & Search
                </p>
              </div>
              <div class="bg-red-50 rounded-xl p-3 sm:p-4 text-center">
                <span
                  class="material-icons-outlined text-red-500 text-2xl sm:text-3xl"
                  >pie_chart</span
                >
                <p class="text-xs sm:text-sm font-medium text-gray-700 mt-1">
                  Visual Charts
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loadingState" class="hidden">
        <div class="bg-white rounded-2xl p-12 sm:p-16 text-center shadow-xl">
          <div class="flex flex-col items-center gap-6">
            <div
              class="w-20 h-20 gpay-gradient rounded-full flex items-center justify-center animate-pulse"
            >
              <span class="material-icons-outlined text-white text-4xl"
                >sync</span
              >
            </div>
            <div>
              <p class="text-xl font-semibold text-gray-800">
                Analyzing your statement...
              </p>
              <p class="text-sm text-gray-500 mt-2">
                Extracting transactions from PDF
              </p>
            </div>
            <div class="w-64 h-2 bg-gray-200 rounded-full overflow-hidden">
              <div
                class="h-full gpay-gradient rounded-full animate-pulse"
                style="width: 60%"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div
        id="resultsSection"
        class="hidden space-y-4 sm:space-y-6 animate-slide-up"
      >
        <!-- Stats Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
          <div
            class="stat-card bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md border border-gray-100"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs sm:text-sm font-medium text-gray-500">
                  Transactions
                </p>
                <p
                  class="text-2xl sm:text-3xl font-bold text-gray-900 mt-1"
                  id="totalCount"
                >
                  0
                </p>
              </div>
              <div
                class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 rounded-xl flex items-center justify-center"
              >
                <span
                  class="material-icons-outlined text-blue-600 text-xl sm:text-2xl"
                  >receipt_long</span
                >
              </div>
            </div>
          </div>

          <div
            class="stat-card bg-gradient-to-br from-red-500 to-rose-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs sm:text-sm font-medium text-red-100">
                  Total Sent
                </p>
                <p class="text-xl sm:text-2xl font-bold text-white mt-1">
                  ₹<span id="totalSent">0</span>
                </p>
              </div>
              <div
                class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-xl flex items-center justify-center"
              >
                <span
                  class="material-icons-outlined text-white text-xl sm:text-2xl"
                  >arrow_upward</span
                >
              </div>
            </div>
          </div>

          <div
            class="stat-card bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs sm:text-sm font-medium text-emerald-100">
                  Total Received
                </p>
                <p class="text-xl sm:text-2xl font-bold text-white mt-1">
                  ₹<span id="totalReceived">0</span>
                </p>
              </div>
              <div
                class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-xl flex items-center justify-center"
              >
                <span
                  class="material-icons-outlined text-white text-xl sm:text-2xl"
                  >arrow_downward</span
                >
              </div>
            </div>
          </div>

          <div
            class="stat-card bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs sm:text-sm font-medium text-violet-100">
                  Net Balance
                </p>
                <p
                  class="text-xl sm:text-2xl font-bold text-white mt-1"
                  id="netBalance"
                >
                  ₹0
                </p>
              </div>
              <div
                class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-xl flex items-center justify-center"
              >
                <span
                  class="material-icons-outlined text-white text-xl sm:text-2xl"
                  >account_balance_wallet</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Chart Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
          <div
            class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md border border-gray-100"
          >
            <h3
              class="font-semibold text-gray-900 mb-4 flex items-center gap-2"
            >
              <span class="material-icons-outlined text-blue-500"
                >pie_chart</span
              >
              Transaction Split
            </h3>
            <div class="h-48 sm:h-64">
              <canvas id="pieChart"></canvas>
            </div>
          </div>

          <div
            class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md border border-gray-100"
          >
            <div class="flex items-center justify-between mb-4 gap-2">
              <div class="flex items-center gap-2">
                <span class="material-icons-outlined text-indigo-500"
                  >stacked_bar_chart</span
                >
                <h3 class="font-semibold text-gray-900">By Name (Top 8)</h3>
              </div>
            </div>
            <div class="h-48 sm:h-64">
              <canvas id="nameChart"></canvas>
            </div>
          </div>

          <div
            class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md border border-gray-100"
          >
            <div class="flex items-center justify-between mb-3 gap-2">
              <div class="flex items-center gap-2">
                <span class="material-icons-outlined text-amber-500"
                  >event</span
                >
                <h3 class="font-semibold text-gray-900">Top Dates (Spend)</h3>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <select
                  id="topDateCount"
                  class="border border-gray-200 rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="5">Top 5</option>
                  <option value="10">Top 10</option>
                </select>
                <select
                  id="topDateMode"
                  class="border border-gray-200 rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="max">Max spend</option>
                  <option value="min">Min spend</option>
                </select>
              </div>
            </div>
            <div class="h-48 sm:h-64">
              <canvas id="topDatesChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Filters -->
        <div
          class="bg-white rounded-xl sm:rounded-2xl shadow-md border border-gray-100 overflow-hidden"
        >
          <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-100">
            <div class="flex items-center gap-2">
              <span class="material-icons-outlined text-blue-500"
                >filter_list</span
              >
              <h2 class="font-semibold text-gray-900">Filters</h2>
            </div>
          </div>

          <div
            class="p-4 sm:p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
          >
            <!-- Date Range Picker -->
            <div class="space-y-2 sm:col-span-2 lg:col-span-1">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <span class="material-icons-outlined text-gray-400 text-lg"
                  >date_range</span
                >
                Date Range
              </label>
              <input
                type="text"
                id="dateRange"
                placeholder="Select date range"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer"
                readonly
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <span class="material-icons-outlined text-gray-400 text-lg"
                  >currency_rupee</span
                >
                Min Amount
              </label>
              <input
                type="number"
                id="minAmount"
                placeholder="₹0"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <span class="material-icons-outlined text-gray-400 text-lg"
                  >currency_rupee</span
                >
                Max Amount
              </label>
              <input
                type="number"
                id="maxAmount"
                placeholder="₹99999"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <span class="material-icons-outlined text-gray-400 text-lg"
                  >person</span
                >
                Name
              </label>
              <input
                type="text"
                id="nameFilter"
                placeholder="Search by name..."
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <span class="material-icons-outlined text-gray-400 text-lg"
                  >account_balance</span
                >
                Bank/Card
              </label>
              <input
                type="text"
                id="bankFilter"
                placeholder="Payment method..."
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <span class="material-icons-outlined text-gray-400 text-lg"
                  >swap_horiz</span
                >
                Type
              </label>
              <div class="flex gap-2">
                <button
                  data-type=""
                  class="type-btn flex-1 px-3 py-3 rounded-xl border-2 border-blue-500 bg-blue-50 text-blue-700 font-medium transition-all text-sm"
                >
                  All
                </button>
                <button
                  data-type="Sent"
                  class="type-btn flex-1 px-3 py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-medium hover:border-red-300 hover:bg-red-50 hover:text-red-600 transition-all flex items-center justify-center gap-1 text-sm"
                >
                  <span class="material-icons-outlined text-sm"
                    >north_east</span
                  >
                  Sent
                </button>
                <button
                  data-type="Received"
                  class="type-btn flex-1 px-3 py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-medium hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-600 transition-all flex items-center justify-center gap-1 text-sm"
                >
                  <span class="material-icons-outlined text-sm"
                    >south_west</span
                  >
                  Received
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Transactions -->
        <div
          class="bg-white rounded-xl sm:rounded-2xl shadow-md border border-gray-100 overflow-hidden"
        >
          <div
            class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-100 flex flex-col sm:flex-row sm:items-center justify-between gap-3"
          >
            <div class="flex items-center gap-2">
              <span class="material-icons-outlined text-blue-500"
                >list_alt</span
              >
              <h2 class="font-semibold text-gray-900">Transactions</h2>
              <span id="filteredCount" class="text-sm text-gray-500"
                >(0 results)</span
              >
            </div>

            <div class="flex items-center gap-2">
              <button
                id="splitBtn"
                class="px-3 py-1.5 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 transition-all hidden"
              >
                Split Selected
              </button>
              <button
                id="reportBtn"
                class="px-3 py-1.5 bg-purple-500 text-white text-sm font-medium rounded-lg hover:bg-purple-600 transition-all"
              >
                Generate Report
              </button>
              <!-- Sort Options -->
              <span class="text-sm text-gray-500">Sort:</span>
              <button
                id="sortDateBtn"
                class="sort-btn active flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium"
                data-sort="date"
                data-order="desc"
              >
                <span class="material-icons-outlined text-sm"
                  >calendar_today</span
                >
                Date
                <span class="material-icons-outlined text-sm sort-icon"
                  >arrow_downward</span
                >
              </button>
              <button
                id="sortAmountBtn"
                class="sort-btn flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium text-gray-600"
                data-sort="amount"
                data-order="desc"
              >
                <span class="material-icons-outlined text-sm"
                  >currency_rupee</span
                >
                Amount
                <span class="material-icons-outlined text-sm sort-icon"
                  >arrow_downward</span
                >
              </button>
            </div>
          </div>

          <!-- Desktop Table -->
          <div class="desktop-table overflow-x-auto">
            <table class="w-full">
              <thead class="bg-red-50">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    <input type="checkbox" id="selectAll" class="mr-2" />
                    Select
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Date
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Type
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Name
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Payment Method
                  </th>
                  <th
                    class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Amount
                  </th>
                </tr>
              </thead>
              <tbody id="tableBody" class="divide-y divide-gray-100"></tbody>
            </table>
          </div>

          <!-- Mobile Cards -->
          <div id="mobileCards" class="mobile-card p-4 space-y-3"></div>

          <!-- Empty State -->
          <div id="emptyState" class="hidden py-12 sm:py-16 text-center">
            <div class="flex flex-col items-center gap-4">
              <div
                class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center"
              >
                <span class="material-icons-outlined text-gray-400 text-3xl"
                  >search_off</span
                >
              </div>
              <div>
                <p class="text-lg font-medium text-gray-700">
                  No transactions found
                </p>
                <p class="text-sm text-gray-500">Try adjusting your filters</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Split Expense Modal -->
    <div
      id="splitModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto"
      >
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Split Expense</h3>
          <button id="closeModal" class="text-gray-400 hover:text-gray-600">
            <span class="material-icons-outlined">close</span>
          </button>
        </div>
        <form id="splitForm">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Expense Name</label
              >
              <input
                type="text"
                id="expenseName"
                required
                class="w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >People Involved (comma separated)</label
              >
              <input
                type="text"
                id="people"
                placeholder="e.g., Alice, Bob, Charlie"
                required
                class="w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Selected Transactions</label
              >
              <div
                id="transactionList"
                class="bg-gray-50 rounded-xl p-4 space-y-2 max-h-40 overflow-y-auto"
              ></div>
            </div>
            <button
              type="submit"
              class="w-full bg-blue-500 text-white py-3 rounded-xl font-medium hover:bg-blue-600 transition-all"
            >
              Save Expense
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Report Section -->
    <div
      id="reportSection"
      class="hidden max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8"
    >
      <div
        class="bg-white rounded-xl sm:rounded-2xl shadow-md border border-gray-100 overflow-hidden"
      >
        <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-100">
          <div class="flex items-center gap-2">
            <span class="material-icons-outlined text-purple-500"
              >assessment</span
            >
            <h2 class="font-semibold text-gray-900">Expense Report</h2>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-purple-50">
              <tr>
                <th
                  class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  Expense Name
                </th>
                <th
                  class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  Transaction Details
                </th>
                <th
                  class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  Owes
                </th>
              </tr>
            </thead>
            <tbody
              id="reportTableBody"
              class="divide-y divide-gray-100"
            ></tbody>
          </table>
        </div>
        <div id="reportEmpty" class="py-12 text-center">
          <p class="text-gray-500">No expenses to report</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer
      class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 text-center"
    >
      <p class="text-xs sm:text-sm text-gray-400">
        Built with ❤️ • 100% Private - All processing happens locally in your
        browser
      </p>
    </footer>

    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      let transactions = [];
      let selectedType = "";
      let currentSort = { field: "date", order: "desc" };
      let dateRangePicker;
      let pieChart;
      let nameChart;
      let topDatesChart;
      let lastFiltered = [];
      let expenses = [];

      // Initialize date picker
      document.addEventListener("DOMContentLoaded", () => {
        dateRangePicker = flatpickr("#dateRange", {
          mode: "range",
          dateFormat: "d M Y",
          placeholder: "Select date range",
          onChange: function (selectedDates) {
            applyFilters();
          },
        });

        document
          .getElementById("topDateCount")
          .addEventListener("change", updateTopDates);
        document
          .getElementById("topDateMode")
          .addEventListener("change", updateTopDates);

        // Select all checkbox
        document.getElementById("selectAll").addEventListener("change", (e) => {
          const checkboxes = document.querySelectorAll(".transaction-checkbox");
          checkboxes.forEach((cb) => (cb.checked = e.target.checked));
          updateSplitButton();
        });

        // Individual checkboxes
        document.addEventListener("change", (e) => {
          if (e.target.classList.contains("transaction-checkbox")) {
            updateSplitButton();
            const selectAll = document.getElementById("selectAll");
            const checkboxes = document.querySelectorAll(
              ".transaction-checkbox"
            );
            const checkedBoxes = document.querySelectorAll(
              ".transaction-checkbox:checked"
            );
            selectAll.checked =
              checkboxes.length === checkedBoxes.length &&
              checkboxes.length > 0;
            selectAll.indeterminate =
              checkedBoxes.length > 0 &&
              checkedBoxes.length < checkboxes.length;
          }
        });

        // Split button
        document.getElementById("splitBtn").addEventListener("click", () => {
          const selectedIds = Array.from(
            document.querySelectorAll(".transaction-checkbox:checked")
          ).map((cb) => parseInt(cb.value));
          const selected = transactions.filter((tx) =>
            selectedIds.includes(tx.id)
          );
          if (selected.length === 0) return;

          document.getElementById("splitModal").classList.remove("hidden");
          document.getElementById("transactionList").innerHTML = selected
            .map(
              (tx) =>
                `<div class="bg-white p-3 rounded-lg border">${
                  tx.name
                } - ${tx.date.toLocaleDateString("en-IN", {
                  day: "numeric",
                  month: "short",
                })} - ₹${tx.amount.toLocaleString("en-IN")}</div>`
            )
            .join("");
        });

        // Close modal
        document.getElementById("closeModal").addEventListener("click", () => {
          document.getElementById("splitModal").classList.add("hidden");
          document.getElementById("splitForm").reset();
        });

        // Split form submit
        document.getElementById("splitForm").addEventListener("submit", (e) => {
          e.preventDefault();
          const expenseName = document
            .getElementById("expenseName")
            .value.trim();
          const peopleStr = document.getElementById("people").value.trim();
          const people = peopleStr
            .split(",")
            .map((p) => p.trim())
            .filter((p) => p);
          if (!expenseName || !people.length) return;

          const selectedIds = Array.from(
            document.querySelectorAll(".transaction-checkbox:checked")
          ).map((cb) => parseInt(cb.value));
          console.log("Selected checkbox elements:", document.querySelectorAll(".transaction-checkbox:checked"));
          console.log("Selected IDs:", selectedIds);
          console.log("All transactions:", transactions.map(tx => ({id: tx.id, name: tx.name})));
          const selected = transactions.filter((tx) =>
            selectedIds.includes(tx.id)
          );
          console.log("Selected transactions:", selected);
          const total = selected.reduce((s, tx) => s + tx.amount, 0);
          const eachOwes = total / people.length;
          const splits = people.map((person) => ({ person, owes: eachOwes }));

          const expense = {
            name: expenseName,
            transactions: selected,
            total,
            people,
            splits,
          };
          console.log("Creating expense:", expense);
          expenses.push(expense);
          console.log("Expenses array now has", expenses.length, "items");

          document.getElementById("splitModal").classList.add("hidden");
          document.getElementById("splitForm").reset();
          document
            .querySelectorAll(".transaction-checkbox")
            .forEach((cb) => (cb.checked = false));
          document.getElementById("selectAll").checked = false;
          updateSplitButton();
          updateReportButton();
        });

        // Report button
        document.getElementById("reportBtn").addEventListener("click", () => {
          console.log("Report button clicked, expenses:", expenses);
          const tbody = document.getElementById("reportTableBody");
          tbody.innerHTML = "";
          if (expenses.length === 0) {
            console.log("No expenses to report");
            document.getElementById("reportEmpty").classList.remove("hidden");
            return;
          }
          console.log("Generating report for", expenses.length, "expenses");
          document.getElementById("reportEmpty").classList.add("hidden");
          expenses.forEach((exp, expIndex) => {
            console.log(
              "Processing expense",
              expIndex,
              ":",
              exp.name,
              "with transactions:",
              exp.transactions
            );
            if (!exp.transactions || exp.transactions.length === 0) {
              console.log("No transactions in expense", exp.name);
              return;
            }
            exp.transactions.forEach((tx, txIndex) => {
              console.log(
                "Processing transaction",
                txIndex,
                ":",
                tx.name,
                tx.amount
              );
              tbody.insertAdjacentHTML(
                "beforeend",
                `
                <tr class="table-row">
                  <td class="px-6 py-4">
                    <div class="text-sm font-medium text-gray-900">${
                      exp.name
                    }</div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-600">${
                      tx.name
                    } - ${tx.date.toLocaleDateString("en-IN", {
                  day: "numeric",
                  month: "short",
                  year: "numeric",
                })} - ₹${tx.amount.toLocaleString("en-IN")}</div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-600">${exp.splits
                      .map((s) => `${s.person}: ₹${s.owes.toFixed(2)}`)
                      .join(", ")}</div>
                  </td>
                </tr>
              `
              );
            });
          });
          document.getElementById("reportSection").classList.remove("hidden");
          console.log("Report section shown");
          // Scroll to report section
          document
            .getElementById("reportSection")
            .scrollIntoView({ behavior: "smooth" });
        });
      });

      // Drag and drop
      const dropZone = document.getElementById("dropZone");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          (e) => {
            e.preventDefault();
            e.stopPropagation();
          },
          false
        );
      });

      ["dragenter", "dragover"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => dropZone.classList.add("drag-over"),
          false
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => dropZone.classList.remove("drag-over"),
          false
        );
      });

      dropZone.addEventListener("drop", (e) => {
        const files = e.dataTransfer.files;
        if (files.length && files[0].type === "application/pdf") {
          handleFile(files[0]);
        }
      });

      document.getElementById("pdfInput").addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) handleFile(file);
      });

      async function handleFile(file) {
        document.getElementById("uploadSection").classList.add("hidden");
        document.getElementById("loadingState").classList.remove("hidden");

        transactions = [];
        const buffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map((t) => t.str).join(" ");
          parsePage(pageText);
        }

        document.getElementById("loadingState").classList.add("hidden");
        document.getElementById("resultsSection").classList.remove("hidden");
        document.getElementById("clearBtn").classList.remove("hidden");
        document.getElementById("clearBtn").classList.add("flex");

        applyFilters();
      }

      function parsePage(text) {
        const regex =
          /(\d{2} \w{3}, \d{4})\s+\d{2}:\d{2} (AM|PM)\s+(Paid to|Received from)\s+(.+?)\s+UPI Transaction ID:.*?(Paid by|Paid to)\s+(.+?)\s+₹([\d,\.]+)/g;

        let match;
        while ((match = regex.exec(text)) !== null) {
          transactions.push({
            id: transactions.length,
            date: new Date(match[1]),
            type: match[3] === "Paid to" ? "Sent" : "Received",
            name: match[4].trim(),
            paidBy: match[6].trim(),
            amount: parseFloat(match[7].replace(/,/g, "")),
          });
        }
      }

      function applyFilters() {
        const dateRange = dateRangePicker.selectedDates;
        const from = dateRange[0] || null;
        const to = dateRange[1] || null;
        const minAmount = parseFloat(
          document.getElementById("minAmount").value
        );
        const maxAmount = parseFloat(
          document.getElementById("maxAmount").value
        );
        const name = document.getElementById("nameFilter").value.toLowerCase();
        const bank = document.getElementById("bankFilter").value.toLowerCase();
        const type = selectedType;

        let sent = 0,
          received = 0,
          count = 0;
        const tbody = document.getElementById("tableBody");
        const mobileCards = document.getElementById("mobileCards");
        tbody.innerHTML = "";
        mobileCards.innerHTML = "";

        let filtered = transactions.filter((tx) => {
          if (from && tx.date < from) return false;
          if (to && tx.date > new Date(to.getTime() + 86400000)) return false;
          if (!isNaN(minAmount) && tx.amount < minAmount) return false;
          if (!isNaN(maxAmount) && tx.amount > maxAmount) return false;
          if (name && !tx.name.toLowerCase().includes(name)) return false;
          if (bank && !tx.paidBy.toLowerCase().includes(bank)) return false;
          if (type && tx.type !== type) return false;
          return true;
        });

        // Sort
        filtered.sort((a, b) => {
          let aVal = currentSort.field === "date" ? a.date.getTime() : a.amount;
          let bVal = currentSort.field === "date" ? b.date.getTime() : b.amount;
          return currentSort.order === "asc" ? aVal - bVal : bVal - aVal;
        });

        filtered.forEach((tx) => {
          count++;
          if (tx.type === "Sent") sent += tx.amount;
          else received += tx.amount;

          const typeClass =
            tx.type === "Sent"
              ? "bg-red-100 text-red-700"
              : "bg-emerald-100 text-emerald-700";
          const typeIcon = tx.type === "Sent" ? "north_east" : "south_west";
          const amountColor =
            tx.type === "Sent" ? "text-red-600" : "text-emerald-600";
          const amountSign = tx.type === "Sent" ? "-" : "+";

          // Desktop row
          tbody.insertAdjacentHTML(
            "beforeend",
            `
            <tr class="table-row">
              <td class="px-6 py-4 whitespace-nowrap">
                <input type="checkbox" class="transaction-checkbox" value="${
                  tx.id
                }" />
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">${tx.date.toLocaleDateString(
                  "en-IN",
                  { day: "numeric", month: "short", year: "numeric" }
                )}</div>
                <div class="text-xs text-gray-500">${tx.date.toLocaleDateString(
                  "en-IN",
                  { weekday: "short" }
                )}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium ${typeClass}">
                  <span class="material-icons-outlined text-xs">${typeIcon}</span>
                  ${tx.type}
                </span>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm font-medium text-gray-900">${tx.name}</div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm text-gray-600">${tx.paidBy}</div>
              </td>
              <td class="px-6 py-4 text-right">
                <div class="text-sm font-semibold ${amountColor}">
                  ${amountSign}₹${tx.amount.toLocaleString("en-IN", {
              minimumFractionDigits: 2,
            })}
                </div>
              </td>
            </tr>
          `
          );

          // Mobile card
          mobileCards.insertAdjacentHTML(
            "beforeend",
            `
            <div class="bg-gray-50 rounded-xl p-4 flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 ${
                  tx.type === "Sent" ? "bg-red-100" : "bg-emerald-100"
                } rounded-full flex items-center justify-center">
                  <span class="material-icons-outlined ${
                    tx.type === "Sent" ? "text-red-600" : "text-emerald-600"
                  }">${typeIcon}</span>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900">${tx.name}</p>
                  <p class="text-xs text-gray-500">${tx.date.toLocaleDateString(
                    "en-IN",
                    { day: "numeric", month: "short" }
                  )} • ${tx.paidBy}</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-sm font-bold ${amountColor}">${amountSign}₹${tx.amount.toLocaleString(
              "en-IN"
            )}</p>
              </div>
            </div>
          `
          );
        });

        document.getElementById("totalSent").textContent = sent.toLocaleString(
          "en-IN",
          { minimumFractionDigits: 2 }
        );
        document.getElementById("totalReceived").textContent =
          received.toLocaleString("en-IN", { minimumFractionDigits: 2 });
        document.getElementById("totalCount").textContent = transactions.length;
        document.getElementById(
          "filteredCount"
        ).textContent = `(${count} results)`;

        const net = received - sent;
        document.getElementById("netBalance").textContent = `${
          net >= 0 ? "+" : ""
        }₹${net.toLocaleString("en-IN", { minimumFractionDigits: 2 })}`;

        document
          .getElementById("emptyState")
          .classList.toggle("hidden", count > 0);
        document
          .getElementById("tableBody")
          .classList.toggle("hidden", count === 0);
        document
          .getElementById("mobileCards")
          .classList.toggle("hidden", count === 0);

        lastFiltered = filtered;
        updateCharts(filtered);
        updateTopDates(filtered);
        updateSplitButton();
        updateReportButton();
      }

      function updateCharts(
        data = lastFiltered.length ? lastFiltered : transactions
      ) {
        const dataset = Array.isArray(data) ? data : [];

        const sent = dataset
          .filter((t) => t.type === "Sent")
          .reduce((s, t) => s + t.amount, 0);
        const received = dataset
          .filter((t) => t.type === "Received")
          .reduce((s, t) => s + t.amount, 0);

        const pieCtx = document.getElementById("pieChart")?.getContext("2d");

        if (pieCtx) {
          if (pieChart) pieChart.destroy();

          pieChart = new Chart(pieCtx, {
            type: "doughnut",
            data: {
              labels: ["Sent", "Received"],
              datasets: [
                {
                  data: [sent, received],
                  backgroundColor: ["#ef4444", "#10b981"],
                  borderWidth: 0,
                  hoverOffset: 10,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: "65%",
              plugins: {
                legend: {
                  position: "bottom",
                  labels: {
                    padding: 20,
                    usePointStyle: true,
                    font: { family: "Inter", size: 12 },
                  },
                },
              },
            },
          });
        }

        const nameCanvas = document.getElementById("nameChart");
        const nameCtx = nameCanvas?.getContext("2d");
        if (!nameCtx) return;

        if (nameChart) nameChart.destroy();

        const nameTotals = {};
        dataset.forEach((t) => {
          if (!nameTotals[t.name])
            nameTotals[t.name] = { sent: 0, received: 0 };
          if (t.type === "Sent") {
            nameTotals[t.name].sent += t.amount;
          } else {
            nameTotals[t.name].received += t.amount;
          }
        });

        const topNames = Object.entries(nameTotals)
          .map(([name, vals]) => ({
            name,
            sent: vals.sent,
            received: vals.received,
            total: vals.sent + vals.received,
          }))
          .sort((a, b) => b.total - a.total)
          .slice(0, 8);

        if (!topNames.length) {
          nameCtx.clearRect(0, 0, nameCanvas.width, nameCanvas.height);
          nameCtx.fillStyle = "#94a3b8";
          nameCtx.font = "12px Inter";
          nameCtx.textAlign = "center";
          nameCtx.fillText(
            "No data",
            nameCanvas.width / 2,
            nameCanvas.height / 2
          );
          return;
        }

        nameChart = new Chart(nameCtx, {
          type: "bar",
          data: {
            labels: topNames.map((n) => n.name),
            datasets: [
              {
                label: "Sent",
                data: topNames.map((n) => n.sent),
                backgroundColor: "#ef4444",
                stack: "stack",
                borderRadius: 6,
              },
              {
                label: "Received",
                data: topNames.map((n) => n.received),
                backgroundColor: "#10b981",
                stack: "stack",
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: "y",
            scales: {
              x: {
                stacked: true,
                ticks: {
                  font: { family: "Inter", size: 11 },
                  callback: (value) =>
                    `₹${Number(value).toLocaleString("en-IN")}`,
                },
                grid: { display: false },
              },
              y: {
                stacked: true,
                ticks: { font: { family: "Inter", size: 11 } },
                grid: { display: false },
              },
            },
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  usePointStyle: true,
                  font: { family: "Inter", size: 11 },
                },
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const label = context.dataset.label || "";
                    const val = context.parsed.x || 0;
                    return `${label}: ₹${val.toLocaleString("en-IN", {
                      minimumFractionDigits: 2,
                      maximumFractionDigits: 2,
                    })}`;
                  },
                },
              },
            },
          },
        });
      }

      function updateTopDates(
        data = lastFiltered.length ? lastFiltered : transactions
      ) {
        const dataset = Array.isArray(data)
          ? data
          : lastFiltered.length
          ? lastFiltered
          : transactions;
        const datesCanvas = document.getElementById("topDatesChart");
        const datesCtx = datesCanvas?.getContext("2d");
        if (!datesCtx) return;

        if (topDatesChart) topDatesChart.destroy();

        const count =
          parseInt(document.getElementById("topDateCount").value, 10) || 5;
        const mode = document.getElementById("topDateMode").value || "max";

        const totals = {};
        dataset
          .filter((t) => t.type === "Sent")
          .forEach((t) => {
            const key = t.date.toISOString().split("T")[0];
            totals[key] = (totals[key] || 0) + t.amount;
          });

        const sorted = Object.entries(totals)
          .map(([dateStr, amount]) => ({
            dateStr,
            amount,
            dateObj: new Date(dateStr),
          }))
          .sort((a, b) =>
            mode === "min" ? a.amount - b.amount : b.amount - a.amount
          )
          .slice(0, count);

        if (!sorted.length) {
          datesCtx.clearRect(0, 0, datesCanvas.width, datesCanvas.height);
          datesCtx.fillStyle = "#94a3b8";
          datesCtx.font = "12px Inter";
          datesCtx.textAlign = "center";
          datesCtx.fillText(
            "No spend data",
            datesCanvas.width / 2,
            datesCanvas.height / 2
          );
          return;
        }

        topDatesChart = new Chart(datesCtx, {
          type: "bar",
          data: {
            labels: sorted.map((d) =>
              d.dateObj.toLocaleDateString("en-IN", {
                day: "numeric",
                month: "short",
              })
            ),
            datasets: [
              {
                label: "Spend",
                data: sorted.map((d) => d.amount),
                backgroundColor: "#f59e0b",
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: "y",
            scales: {
              x: {
                ticks: {
                  font: { family: "Inter", size: 11 },
                  callback: (value) =>
                    `₹${Number(value).toLocaleString("en-IN")}`,
                },
                grid: { display: false },
              },
              y: {
                ticks: { font: { family: "Inter", size: 11 } },
                grid: { display: false },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const val = context.parsed.x || 0;
                    return `Spend: ₹${val.toLocaleString("en-IN", {
                      minimumFractionDigits: 2,
                      maximumFractionDigits: 2,
                    })}`;
                  },
                },
              },
            },
          },
        });
      }

      // Type filter buttons
      document.querySelectorAll(".type-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          selectedType = btn.dataset.type;
          document.querySelectorAll(".type-btn").forEach((b) => {
            b.classList.remove(
              "border-blue-500",
              "bg-blue-50",
              "text-blue-700",
              "border-red-500",
              "bg-red-50",
              "text-red-700",
              "border-emerald-500",
              "bg-emerald-50",
              "text-emerald-700"
            );
            b.classList.add("border-gray-200", "text-gray-600");
          });

          if (selectedType === "Sent") {
            btn.classList.remove("border-gray-200", "text-gray-600");
            btn.classList.add("border-red-500", "bg-red-50", "text-red-700");
          } else if (selectedType === "Received") {
            btn.classList.remove("border-gray-200", "text-gray-600");
            btn.classList.add(
              "border-emerald-500",
              "bg-emerald-50",
              "text-emerald-700"
            );
          } else {
            btn.classList.remove("border-gray-200", "text-gray-600");
            btn.classList.add("border-blue-500", "bg-blue-50", "text-blue-700");
          }

          applyFilters();
        });
      });

      // Sort buttons
      document.querySelectorAll(".sort-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const field = btn.dataset.sort;

          if (currentSort.field === field) {
            currentSort.order = currentSort.order === "asc" ? "desc" : "asc";
          } else {
            // Quick range pills
            document.querySelectorAll(".pill-btn").forEach((btn) => {
              const range = btn.dataset.quickrange;
              if (!range) return;
              btn.addEventListener("click", () => {
                document
                  .querySelectorAll(".pill-btn[data-quickrange]")
                  .forEach((b) => b.classList.remove("active"));
                btn.classList.add("active");

                const today = new Date();
                let start = null;
                let end = today;

                if (range === "7") {
                  start = new Date();
                  start.setDate(today.getDate() - 6);
                } else if (range === "30") {
                  start = new Date();
                  start.setDate(today.getDate() - 29);
                } else if (range === "month") {
                  start = new Date(today.getFullYear(), today.getMonth(), 1);
                } else if (range === "high") {
                  document.getElementById("minAmount").value = 10000;
                  applyFilters();
                  return;
                }

                if (start) {
                  dateRangePicker.setDate([start, end], true);
                }
                document.getElementById("minAmount").value = "";
                applyFilters();
              });
            });
            currentSort.field = field;
            currentSort.order = "desc";
          }

          document.querySelectorAll(".sort-btn").forEach((b) => {
            b.classList.remove("active", "text-blue-600");
            b.classList.add("text-gray-600");
            b.querySelector(".sort-icon").textContent = "arrow_downward";
          });

          btn.classList.add("active", "text-blue-600");
          btn.classList.remove("text-gray-600");
          btn.querySelector(".sort-icon").textContent =
            currentSort.order === "asc" ? "arrow_upward" : "arrow_downward";

          applyFilters();
        });
      });

      // Clear button
      document.getElementById("clearBtn").addEventListener("click", () => {
        transactions = [];
        expenses = [];
        document.getElementById("resultsSection").classList.add("hidden");
        document.getElementById("reportSection").classList.add("hidden");
        document.getElementById("uploadSection").classList.remove("hidden");
        document.getElementById("clearBtn").classList.add("hidden");
        document.getElementById("pdfInput").value = "";
        dateRangePicker.clear();
        if (pieChart) pieChart.destroy();
        if (nameChart) nameChart.destroy();
        if (topDatesChart) topDatesChart.destroy();
        updateSplitButton();
        updateReportButton();
      });

      function updateSplitButton() {
        const checkedBoxes = document.querySelectorAll(
          ".transaction-checkbox:checked"
        );
        const btn = document.getElementById("splitBtn");
        if (checkedBoxes.length > 0) {
          btn.classList.remove("hidden");
        } else {
          btn.classList.add("hidden");
        }
      }

      function updateReportButton() {
        const btn = document.getElementById("reportBtn");
        if (expenses.length > 0) {
          btn.classList.remove("hidden");
        } else {
          btn.classList.add("hidden");
        }
      }

      document
        .querySelectorAll("input:not([readonly])")
        .forEach((el) => el.addEventListener("input", applyFilters));
    </script>
  </body>
</html>
