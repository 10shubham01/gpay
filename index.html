<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Pay Statement Analyzer</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            animation: {
              "fade-in": "fadeIn 0.5s ease-out",
              "slide-up": "slideUp 0.4s ease-out",
              "pulse-slow": "pulse 3s infinite",
            },
          },
        },
      };
    </script>

    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .drag-over {
        border-color: #6366f1 !important;
        background-color: #eef2ff !important;
      }
      .filter-input {
        transition: all 0.2s ease;
      }
      .filter-input:focus {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
      }
      .table-row {
        transition: all 0.2s ease;
      }
      .table-row:hover {
        background-color: #f8fafc;
        transform: scale(1.002);
      }
      .stat-card {
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
      }
      .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .scrollbar-thin::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>

  <body
    class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen"
  >
    <!-- Header -->
    <header
      class="bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div
              class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/30"
            >
              <i data-lucide="wallet" class="w-5 h-5 text-white"></i>
            </div>
            <div>
              <h1
                class="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent"
              >
                GPay Statement Analyzer
              </h1>
              <p class="text-xs text-gray-500">
                Analyze your transactions with ease
              </p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <button
              id="exportBtn"
              class="hidden items-center gap-2 px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-sm font-medium rounded-lg hover:from-emerald-600 hover:to-teal-600 transition-all shadow-md shadow-emerald-500/25 hover:shadow-lg hover:shadow-emerald-500/30"
            >
              <i data-lucide="download" class="w-4 h-4"></i>
              Export CSV
            </button>
            <button
              id="clearBtn"
              class="hidden items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-all"
            >
              <i data-lucide="x" class="w-4 h-4"></i>
              Clear
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Upload Section -->
      <div id="uploadSection" class="animate-fade-in mb-8">
        <div
          id="dropZone"
          class="relative bg-white rounded-2xl border-2 border-dashed border-gray-300 p-12 text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/30 transition-all duration-300"
        >
          <input
            type="file"
            id="pdfInput"
            accept="application/pdf"
            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
          />
          <div class="flex flex-col items-center gap-4">
            <div
              class="w-20 h-20 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl flex items-center justify-center"
            >
              <i data-lucide="file-up" class="w-10 h-10 text-indigo-500"></i>
            </div>
            <div>
              <p class="text-lg font-semibold text-gray-700">
                Drop your GPay statement PDF here
              </p>
              <p class="text-sm text-gray-500 mt-1">
                or click to browse from your device
              </p>
            </div>
            <div class="flex items-center gap-2 text-xs text-gray-400">
              <i data-lucide="shield-check" class="w-4 h-4"></i>
              <span>Your data stays in your browser - nothing is uploaded</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loadingState" class="hidden mb-8">
        <div
          class="bg-white rounded-2xl p-12 text-center shadow-xl shadow-gray-200/50"
        >
          <div class="flex flex-col items-center gap-4">
            <div
              class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-500 rounded-full animate-spin"
            ></div>
            <p class="text-lg font-medium text-gray-700">
              Analyzing your statement...
            </p>
            <p class="text-sm text-gray-500">This might take a few seconds</p>
          </div>
        </div>
      </div>

      <!-- Results Section (Initially Hidden) -->
      <div id="resultsSection" class="hidden space-y-6 animate-slide-up">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div
            class="stat-card bg-white rounded-2xl p-6 shadow-lg shadow-gray-200/50"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-500">
                  Total Transactions
                </p>
                <p
                  class="text-3xl font-bold text-gray-900 mt-1"
                  id="totalCount"
                >
                  0
                </p>
              </div>
              <div
                class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center"
              >
                <i data-lucide="receipt" class="w-6 h-6 text-indigo-600"></i>
              </div>
            </div>
          </div>

          <div
            class="stat-card bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-6 shadow-lg shadow-red-500/25"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-red-100">Total Sent</p>
                <p class="text-3xl font-bold text-white mt-1">
                  ₹<span id="totalSent">0</span>
                </p>
              </div>
              <div
                class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center"
              >
                <i data-lucide="arrow-up-right" class="w-6 h-6 text-white"></i>
              </div>
            </div>
          </div>

          <div
            class="stat-card bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-6 shadow-lg shadow-emerald-500/25"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-emerald-100">
                  Total Received
                </p>
                <p class="text-3xl font-bold text-white mt-1">
                  ₹<span id="totalReceived">0</span>
                </p>
              </div>
              <div
                class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center"
              >
                <i data-lucide="arrow-down-left" class="w-6 h-6 text-white"></i>
              </div>
            </div>
          </div>

          <div
            class="stat-card bg-gradient-to-br from-violet-500 to-purple-600 rounded-2xl p-6 shadow-lg shadow-violet-500/25"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-violet-100">Net Balance</p>
                <p class="text-3xl font-bold text-white mt-1" id="netBalance">
                  ₹0
                </p>
              </div>
              <div
                class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center"
              >
                <i data-lucide="scale" class="w-6 h-6 text-white"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Filters -->
        <div
          class="bg-white rounded-2xl shadow-lg shadow-gray-200/50 overflow-hidden"
        >
          <div
            class="px-6 py-4 border-b border-gray-100 flex items-center justify-between"
          >
            <div class="flex items-center gap-2">
              <i data-lucide="filter" class="w-5 h-5 text-indigo-500"></i>
              <h2 class="font-semibold text-gray-900">Filters</h2>
            </div>
            <button
              id="resetFilters"
              class="text-sm text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1"
            >
              <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
              Reset All
            </button>
          </div>

          <div class="p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <i data-lucide="calendar" class="w-4 h-4 text-gray-400"></i>
                From Date
              </label>
              <input
                type="date"
                id="fromDate"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <i data-lucide="calendar" class="w-4 h-4 text-gray-400"></i>
                To Date
              </label>
              <input
                type="date"
                id="toDate"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <i data-lucide="indian-rupee" class="w-4 h-4 text-gray-400"></i>
                Min Amount
              </label>
              <input
                type="number"
                id="minAmount"
                placeholder="₹0"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <i data-lucide="indian-rupee" class="w-4 h-4 text-gray-400"></i>
                Max Amount
              </label>
              <input
                type="number"
                id="maxAmount"
                placeholder="₹99999"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <i data-lucide="user" class="w-4 h-4 text-gray-400"></i>
                Name
              </label>
              <input
                type="text"
                id="nameFilter"
                placeholder="Paid to / Received from"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <i data-lucide="building-2" class="w-4 h-4 text-gray-400"></i>
                Bank/Card
              </label>
              <input
                type="text"
                id="bankFilter"
                placeholder="Payment method"
                class="filter-input w-full border border-gray-200 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>

            <div class="space-y-2 sm:col-span-2 lg:col-span-2">
              <label
                class="text-sm font-medium text-gray-700 flex items-center gap-2"
              >
                <i
                  data-lucide="arrow-left-right"
                  class="w-4 h-4 text-gray-400"
                ></i>
                Transaction Type
              </label>
              <div class="flex gap-2">
                <button
                  data-type=""
                  class="type-btn flex-1 px-4 py-3 rounded-xl border-2 border-indigo-500 bg-indigo-50 text-indigo-700 font-medium transition-all"
                >
                  All
                </button>
                <button
                  data-type="Sent"
                  class="type-btn flex-1 px-4 py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-medium hover:border-red-300 hover:bg-red-50 hover:text-red-600 transition-all flex items-center justify-center gap-2"
                >
                  <i data-lucide="arrow-up-right" class="w-4 h-4"></i>
                  Sent
                </button>
                <button
                  data-type="Received"
                  class="type-btn flex-1 px-4 py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-medium hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-600 transition-all flex items-center justify-center gap-2"
                >
                  <i data-lucide="arrow-down-left" class="w-4 h-4"></i>
                  Received
                </button>
              </div>
              <select id="typeFilter" class="hidden">
                <option value="">All</option>
                <option value="Sent">Sent</option>
                <option value="Received">Received</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Transactions Table -->
        <div
          class="bg-white rounded-2xl shadow-lg shadow-gray-200/50 overflow-hidden"
        >
          <div
            class="px-6 py-4 border-b border-gray-100 flex items-center justify-between"
          >
            <div class="flex items-center gap-2">
              <i data-lucide="list" class="w-5 h-5 text-indigo-500"></i>
              <h2 class="font-semibold text-gray-900">Transactions</h2>
              <span id="filteredCount" class="text-sm text-gray-500 ml-2"
                >(0 results)</span
              >
            </div>
          </div>

          <div class="overflow-auto max-h-[600px] scrollbar-thin">
            <table class="w-full">
              <thead class="bg-gray-50 sticky top-0">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Date
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Type
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Name
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Payment Method
                  </th>
                  <th
                    class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider"
                  >
                    Amount
                  </th>
                </tr>
              </thead>
              <tbody id="tableBody" class="divide-y divide-gray-100"></tbody>
            </table>

            <!-- Empty State -->
            <div id="emptyState" class="hidden py-16 text-center">
              <div class="flex flex-col items-center gap-4">
                <div
                  class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center"
                >
                  <i data-lucide="search-x" class="w-8 h-8 text-gray-400"></i>
                </div>
                <div>
                  <p class="text-lg font-medium text-gray-700">
                    No transactions found
                  </p>
                  <p class="text-sm text-gray-500">
                    Try adjusting your filters
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
      <p class="text-sm text-gray-400">
        Built with ❤️ for easy transaction analysis • All processing happens
        locally in your browser
      </p>
    </footer>

    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      let transactions = [];
      let selectedType = "";

      // Initialize Lucide icons
      document.addEventListener("DOMContentLoaded", () => {
        lucide.createIcons();
      });

      // Drag and drop functionality
      const dropZone = document.getElementById("dropZone");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => dropZone.classList.add("drag-over"),
          false
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => dropZone.classList.remove("drag-over"),
          false
        );
      });

      dropZone.addEventListener("drop", (e) => {
        const files = e.dataTransfer.files;
        if (files.length && files[0].type === "application/pdf") {
          handleFile(files[0]);
        }
      });

      document
        .getElementById("pdfInput")
        .addEventListener("change", async (e) => {
          const file = e.target.files[0];
          if (file) handleFile(file);
        });

      async function handleFile(file) {
        document.getElementById("uploadSection").classList.add("hidden");
        document.getElementById("loadingState").classList.remove("hidden");

        transactions = [];
        const buffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map((t) => t.str).join(" ");
          parsePage(pageText);
        }

        document.getElementById("loadingState").classList.add("hidden");
        document.getElementById("resultsSection").classList.remove("hidden");
        document.getElementById("exportBtn").classList.remove("hidden");
        document.getElementById("exportBtn").classList.add("flex");
        document.getElementById("clearBtn").classList.remove("hidden");
        document.getElementById("clearBtn").classList.add("flex");

        applyFilters();
        lucide.createIcons();
      }

      function parsePage(text) {
        const regex =
          /(\d{2} \w{3}, \d{4})\s+\d{2}:\d{2} (AM|PM)\s+(Paid to|Received from)\s+(.+?)\s+UPI Transaction ID:.*?(Paid by|Paid to)\s+(.+?)\s+₹([\d,\.]+)/g;

        let match;
        while ((match = regex.exec(text)) !== null) {
          transactions.push({
            date: new Date(match[1]),
            type: match[3] === "Paid to" ? "Sent" : "Received",
            name: match[4].trim(),
            paidBy: match[6].trim(),
            amount: parseFloat(match[7].replace(/,/g, "")),
          });
        }
      }

      function applyFilters() {
        const from = document.getElementById("fromDate").value;
        const to = document.getElementById("toDate").value;
        const minAmount = parseFloat(
          document.getElementById("minAmount").value
        );
        const maxAmount = parseFloat(
          document.getElementById("maxAmount").value
        );
        const name = document.getElementById("nameFilter").value.toLowerCase();
        const bank = document.getElementById("bankFilter").value.toLowerCase();
        const type = selectedType;

        let sent = 0,
          received = 0,
          count = 0;
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

        const filtered = transactions.filter((tx) => {
          if (from && tx.date < new Date(from)) return false;
          if (to && tx.date > new Date(to)) return false;
          if (!isNaN(minAmount) && tx.amount < minAmount) return false;
          if (!isNaN(maxAmount) && tx.amount > maxAmount) return false;
          if (name && !tx.name.toLowerCase().includes(name)) return false;
          if (bank && !tx.paidBy.toLowerCase().includes(bank)) return false;
          if (type && tx.type !== type) return false;
          return true;
        });

        filtered.forEach((tx) => {
          count++;
          if (tx.type === "Sent") sent += tx.amount;
          else received += tx.amount;

          const typeClass =
            tx.type === "Sent"
              ? "bg-red-100 text-red-700"
              : "bg-emerald-100 text-emerald-700";
          const typeIcon =
            tx.type === "Sent"
              ? '<i data-lucide="arrow-up-right" class="w-3 h-3"></i>'
              : '<i data-lucide="arrow-down-left" class="w-3 h-3"></i>';

          tbody.insertAdjacentHTML(
            "beforeend",
            `<tr class="table-row">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">${tx.date.toLocaleDateString(
                  "en-IN",
                  { day: "numeric", month: "short", year: "numeric" }
                )}</div>
                <div class="text-xs text-gray-500">${tx.date.toLocaleDateString(
                  "en-IN",
                  { weekday: "long" }
                )}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium ${typeClass}">
                  ${typeIcon}
                  ${tx.type}
                </span>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm font-medium text-gray-900">${tx.name}</div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm text-gray-600">${tx.paidBy}</div>
              </td>
              <td class="px-6 py-4 text-right">
                <div class="text-sm font-semibold ${
                  tx.type === "Sent" ? "text-red-600" : "text-emerald-600"
                }">
                  ${tx.type === "Sent" ? "-" : "+"}₹${tx.amount.toLocaleString(
              "en-IN",
              { minimumFractionDigits: 2 }
            )}
                </div>
              </td>
            </tr>`
          );
        });

        document.getElementById("totalSent").textContent = sent.toLocaleString(
          "en-IN",
          { minimumFractionDigits: 2 }
        );
        document.getElementById("totalReceived").textContent =
          received.toLocaleString("en-IN", { minimumFractionDigits: 2 });
        document.getElementById("totalCount").textContent = transactions.length;
        document.getElementById(
          "filteredCount"
        ).textContent = `(${count} results)`;

        const net = received - sent;
        const netEl = document.getElementById("netBalance");
        netEl.textContent = `${net >= 0 ? "+" : ""}₹${net.toLocaleString(
          "en-IN",
          { minimumFractionDigits: 2 }
        )}`;

        // Show/hide empty state
        document
          .getElementById("emptyState")
          .classList.toggle("hidden", count > 0);
        document
          .getElementById("tableBody")
          .classList.toggle("hidden", count === 0);

        lucide.createIcons();
      }

      // Type filter buttons
      document.querySelectorAll(".type-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          selectedType = btn.dataset.type;
          document.querySelectorAll(".type-btn").forEach((b) => {
            b.classList.remove(
              "border-indigo-500",
              "bg-indigo-50",
              "text-indigo-700",
              "border-red-500",
              "bg-red-50",
              "text-red-700",
              "border-emerald-500",
              "bg-emerald-50",
              "text-emerald-700"
            );
            b.classList.add("border-gray-200", "text-gray-600");
          });

          if (selectedType === "Sent") {
            btn.classList.remove("border-gray-200", "text-gray-600");
            btn.classList.add("border-red-500", "bg-red-50", "text-red-700");
          } else if (selectedType === "Received") {
            btn.classList.remove("border-gray-200", "text-gray-600");
            btn.classList.add(
              "border-emerald-500",
              "bg-emerald-50",
              "text-emerald-700"
            );
          } else {
            btn.classList.remove("border-gray-200", "text-gray-600");
            btn.classList.add(
              "border-indigo-500",
              "bg-indigo-50",
              "text-indigo-700"
            );
          }

          applyFilters();
        });
      });

      // Reset filters
      document.getElementById("resetFilters").addEventListener("click", () => {
        document.getElementById("fromDate").value = "";
        document.getElementById("toDate").value = "";
        document.getElementById("minAmount").value = "";
        document.getElementById("maxAmount").value = "";
        document.getElementById("nameFilter").value = "";
        document.getElementById("bankFilter").value = "";
        selectedType = "";

        document.querySelectorAll(".type-btn").forEach((b) => {
          b.classList.remove(
            "border-indigo-500",
            "bg-indigo-50",
            "text-indigo-700",
            "border-red-500",
            "bg-red-50",
            "text-red-700",
            "border-emerald-500",
            "bg-emerald-50",
            "text-emerald-700"
          );
          b.classList.add("border-gray-200", "text-gray-600");
        });
        document
          .querySelector('.type-btn[data-type=""]')
          .classList.remove("border-gray-200", "text-gray-600");
        document
          .querySelector('.type-btn[data-type=""]')
          .classList.add(
            "border-indigo-500",
            "bg-indigo-50",
            "text-indigo-700"
          );

        applyFilters();
      });

      // Clear button
      document.getElementById("clearBtn").addEventListener("click", () => {
        transactions = [];
        document.getElementById("resultsSection").classList.add("hidden");
        document.getElementById("uploadSection").classList.remove("hidden");
        document.getElementById("exportBtn").classList.add("hidden");
        document.getElementById("clearBtn").classList.add("hidden");
        document.getElementById("pdfInput").value = "";
      });

      // Export to CSV
      document.getElementById("exportBtn").addEventListener("click", () => {
        const headers = ["Date", "Type", "Name", "Payment Method", "Amount"];
        const rows = transactions.map((tx) => [
          tx.date.toLocaleDateString("en-IN"),
          tx.type,
          `"${tx.name}"`,
          `"${tx.paidBy}"`,
          tx.amount.toFixed(2),
        ]);

        const csv = [headers.join(","), ...rows.map((r) => r.join(","))].join(
          "\n"
        );
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "gpay-transactions.csv";
        a.click();
        URL.revokeObjectURL(url);
      });

      document
        .querySelectorAll("input:not(.type-btn), select")
        .forEach((el) => el.addEventListener("input", applyFilters));
    </script>
  </body>
</html>
